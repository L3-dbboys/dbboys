# 通过表名和索引名删除约束  
在需要删除约束的场景下，JDBC元数据无法获取约束名称，可能通过创建存储过程的方式，使用表名和索引名删除约束。  
```sql
update sysprocedures set mode = 'o' where procname = 'metadata_dropconstraintbyindex';
drop function if exists metadata_dropconstraintbyindex(varchar,varchar);
create dba function metadata_dropconstraintbyindex(p_tabname varchar(128), p_idxname varchar(128))
returns int as rc;
  define v_sql_err int;
  define v_sqlstr lvarchar;
  define v_constrname varchar(128);

  on exception set v_sql_err
    return v_sql_err;
  end exception;
  
  let v_sqlstr = '';
  let v_constrname = '';
  if p_tabname is null or p_tabname = '' or p_idxname is null or p_idxname = '' then 
    return 255;
  end if;

  SELECT c.constrname INTO v_constrname 
  FROM sysconstraints c, systables t
  WHERE c.tabid = t.tabid 
  AND c.idxname = p_idxname
  AND t.tabname = p_tabname;
  
  if v_constrname is null or v_constrname = '' then 
    return 254;
  end if;
  
  let v_sqlstr = 'alter table ' || p_tabname || ' drop constraint ' || v_constrname;
  execute immediate v_sqlstr;
  return 0;
end function;
update sysprocedures set mode = 'd' where procname = 'metadata_dropconstraintbyindex';
```
通过 表名 和 字段名 获取约束名称的语句   
```sql
SELECT con.constrname  -- con.constrtype C = Check constraint，N = Not NULL，P = Primary key，R = Referential，T = Table，U = Unique
FROM systables tab, syscolumns col, sysindexes idx, sysconstraints con
WHERE tab.tabname = 'tabuk'      -- 表名
AND tab.tabid = col.tabid  
AND col.colname = 'col3'         -- 字段名
AND tab.tabid = idx.tabid
AND tab.tabid = con.tabid
AND idx.idxname = con.idxname
AND (abs(idx.part1) = col.colno  OR abs(idx.part2) = col.colno  OR abs(idx.part3) = col.colno  OR abs(idx.part4) = col.colno
  OR abs(idx.part5) = col.colno  OR abs(idx.part6) = col.colno  OR abs(idx.part7) = col.colno  OR abs(idx.part8) = col.colno
  OR abs(idx.part9) = col.colno  OR abs(idx.part10) = col.colno OR abs(idx.part11) = col.colno OR abs(idx.part12) = col.colno
  OR abs(idx.part13) = col.colno OR abs(idx.part14) = col.colno OR abs(idx.part15) = col.colno OR abs(idx.part16) = col.colno
);
```