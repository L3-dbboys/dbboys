### 配置开启审计
GBase 8s审计数据默认存储在文件，默认配置文件$GBASEDBTDIR/aaodir/adtcfg，修改配置
```
#创建审计日志目录
mkdir /data/gbase/auditdata
#修改权限
chmod 775 /data/gbase/auditdata
#修改配置参数
sed -i "s#^ADTPATH.*#ADTPATH /data/gbase/auditdata#g" $GBASEDBTDIR/aaodir/adtcfg
onaudit -p /data/gbase/auditdata
#开启审计
onaudit -l 1
#增加审计掩码（审计事件）
onaudit -a -u _default -e +DRDS,DRIX,DRTB
```
如相关操作报以下错误：
```
Cannot set audit configuration parameters.
Problem may be caused by lack of permission, bad
parameter values, or bad parameter combinations.
```
检查数据库是否设置了DELIMIDENT环境变量。
### 增加审计掩码
修改_default增加所支持的所有掩码  
```shell
onaudit -m -u _default -e +ACTB,ADCK,ADLG,ALIX,ALTB,BGTX,STSV,CLDB,CMTX,CRAM,CRBS,CRDB,CRDS,CRIX,CRSN,CRSP,CRTB,CRTR,CRVW,DLRW,DNCK,DNDM,DRAM,DRBS,DRCK,DRDB,DRDS,DRIX,RLSV,DRLG,DRSN,DRSP,DRTB,DRTR,DRVW,EXSP,GRDB,GRTB,INRW,LGDB,LKTB,LSAM,LSDB,MDLG,RVLB,ONAU,ONCH,ONIN,ONLG,ONLO,ONMO,ONPA,GRSS,ONSP,ONST,ONTP,ONUL,OPDB,GRSA,RVSA,RDRW,RLTX,RMCK,RNTC,RVDB,RVTB,SCSP,RVSS,STCN,STDF,STEX,STIL,STLM,STSN,ULTB,UPAM,UPCK,UPDM,UPRW,USSP,USTB,ALFR,STDS,STPR,STTX,STOM,STRT,STOP,GRFR,RVFR,CRRL,DRRL,GRRL,RVRL,STDP,STRL,STSA,ONMN,RNDB,ONBR,ONPL,OPST,CRRT,DRRT,CRDT,CRCT,DRCT,CRBT,DRTY,CRME,DRME,ALME,CROC,DROC,RBSV,STRS,CRAG,DRAG,STSC,RVXM,RNIX,CRSQ,RNSQ,DRSQ,ALSQ,STEV,RNDS,GRDR,RVDR,STCO,STNC,STEP,CRPT,CRXT,CRXD,DRXT,DRXD,TCTB,SVXD,CRLC,CRPL,CRLB,DRLC,DRPL,DRLB,RNLC,RNPL,RNLB,ALLC,GRXM,GRLB,CRTX,ALTX,RNTX,DRTX,CRUR,ALUR,DRUR,RNUR,PWUR
```
如果尚未设置过掩码，使用
```shell
onaudit -a -u _default -e +ACTB,ADCK,ADLG,ALIX,ALTB,BGTX,STSV,CLDB,CMTX,CRAM,CRBS,CRDB,CRDS,CRIX,CRSN,CRSP,CRTB,CRTR,CRVW,DLRW,DNCK,DNDM,DRAM,DRBS,DRCK,DRDB,DRDS,DRIX,RLSV,DRLG,DRSN,DRSP,DRTB,DRTR,DRVW,EXSP,GRDB,GRTB,INRW,LGDB,LKTB,LSAM,LSDB,MDLG,RVLB,ONAU,ONCH,ONIN,ONLG,ONLO,ONMO,ONPA,GRSS,ONSP,ONST,ONTP,ONUL,OPDB,GRSA,RVSA,RDRW,RLTX,RMCK,RNTC,RVDB,RVTB,SCSP,RVSS,STCN,STDF,STEX,STIL,STLM,STSN,ULTB,UPAM,UPCK,UPDM,UPRW,USSP,USTB,ALFR,STDS,STPR,STTX,STOM,STRT,STOP,GRFR,RVFR,CRRL,DRRL,GRRL,RVRL,STDP,STRL,STSA,ONMN,RNDB,ONBR,ONPL,OPST,CRRT,DRRT,CRDT,CRCT,DRCT,CRBT,DRTY,CRME,DRME,ALME,CROC,DROC,RBSV,STRS,CRAG,DRAG,STSC,RVXM,RNIX,CRSQ,RNSQ,DRSQ,ALSQ,STEV,RNDS,GRDR,RVDR,STCO,STNC,STEP,CRPT,CRXT,CRXD,DRXT,DRXD,TCTB,SVXD,CRLC,CRPL,CRLB,DRLC,DRPL,DRLB,RNLC,RNPL,RNLB,ALLC,GRXM,GRLB,CRTX,ALTX,RNTX,DRTX,CRUR,ALUR,DRUR,RNUR,PWUR
```
### 查看审计日志
```
onshowaudit
```
参考输出
```

ONLN|2023-12-20 15:20:23.210|dbhost1|36286|gbase01|gbasedbt|0:RDRW:testdb:105:1049063:257::

ONLN|2023-12-20 15:20:23.210|dbhost1|36286|gbase01|gbasedbt|0:UPRW:testdb:105:1049063:257:1049063:257::

ONLN|2023-12-20 15:21:12.975|dbhost1|36286|gbase01|gbasedbt|0:INRW:testdb:105:1049064:257::

ONLN|2023-12-20 15:21:16.399|dbhost1|36286|gbase01|gbasedbt|0:RDRW:testdb:105:1049063:257::

ONLN|2023-12-20 15:21:16.403|dbhost1|36286|gbase01|gbasedbt|0:UPRW:testdb:105:1049063:257:1049063:257::

ONLN|2023-12-20 15:21:16.407|dbhost1|36286|gbase01|gbasedbt|0:RDRW:testdb:105:1049064:257::

ONLN|2023-12-20 15:21:16.409|dbhost1|36286|gbase01|gbasedbt|0:UPRW:testdb:105:1049064:257:1049064:257::
```
说明：
```
•	ONLN 为固定标记。
•	2023-12-20 15:21:16.409 为时间戳。
•	dbhost1 为host name。
•	36286 为进程PID。
•	gbase01 为数据库server 名。
•	gbasedbt 为用户名。
•	0 为errno。
•	INRW 为insert 语句。
•	demodb 为数据库名。
•	105 为tabid。
•	1049064 为partnum。
•	257 为rowid。
```

### 关闭审计
```
onauit -l 0
```
参考文档【[GBase 8s 安全技术指南.pdf](https://www.dbboys.com/dl/gbase8s/docs/Security_Guide.pdf)】
